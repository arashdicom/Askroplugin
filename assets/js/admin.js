/*! For license information please see admin.js.LICENSE.txt */
!function(t){"use strict";window.AskroAdmin={config:{ajaxUrl:askroAdmin.ajax_url||"",nonce:askroAdmin.nonce||"",strings:askroAdmin.strings||{}},init:function(){this.bindEvents(),this.initComponents(),this.initCharts()},bindEvents:function(){t(document).ready(this.onDocumentReady.bind(this)),t(document).on("click",".askro-admin-tab",this.handleTabClick.bind(this)),t(document).on("click",".askro-inline-edit",this.handleInlineEdit.bind(this)),t(document).on("click",".askro-inline-save",this.handleInlineSave.bind(this)),t(document).on("click",".askro-inline-cancel",this.handleInlineCancel.bind(this)),t(document).on("change",".askro-select-all",this.handleSelectAll.bind(this)),t(document).on("click",".askro-bulk-action",this.handleBulkAction.bind(this)),t(document).on("click",".askro-system-tool",this.handleSystemTool.bind(this)),t(document).on("submit",".askro-settings-form",this.handleSettingsSubmit.bind(this))},onDocumentReady:function(){this.initTabs(),this.initDataTables(),this.initColorPickers(),this.initTooltips(),this.loadDashboardData()},initComponents:function(){this.initSortableTables(),this.initFormValidation(),this.initMediaUploader()},initTabs:function(){if(t(".askro-admin-tab:first").addClass("active"),t(".askro-admin-tab-content:first").addClass("active"),window.location.hash){var i=window.location.hash.substring(1);this.showTab(i)}},handleTabClick:function(i){i.preventDefault();var a=t(i.currentTarget).data("tab");this.showTab(a),window.history.replaceState(null,null,"#"+a)},showTab:function(i){t(".askro-admin-tab").removeClass("active"),t(".askro-admin-tab-content").removeClass("active"),t('[data-tab="'+i+'"]').addClass("active"),t("#"+i).addClass("active")},initDataTables:function(){t(".askro-data-table").each(function(){var i=t(this);i.data("options"),i.find("th[data-sort]").addClass("askro-sortable").on("click",function(){var a=t(this),n=a.data("sort"),o="asc"===(a.data("order")||"asc")?"desc":"asc";AskroAdmin.sortTable(i,n,o),i.find("th").removeClass("askro-sort-asc askro-sort-desc"),a.addClass("askro-sort-"+o).data("order",o)})})},sortTable:function(i,a,n){var o=i.find("tbody"),s=o.find("tr").toArray();s.sort(function(i,o){var s=t(i).find("[data-sort-value]").data("sort-value")||t(i).find("td").eq(t(i).find('th[data-sort="'+a+'"]').index()).text(),e=t(o).find("[data-sort-value]").data("sort-value")||t(o).find("td").eq(t(o).find('th[data-sort="'+a+'"]').index()).text();return"asc"===n?s>e?1:-1:s<e?1:-1}),o.empty().append(s)},handleInlineEdit:function(i){i.preventDefault();var a=t(i.currentTarget),n=a.closest("tr");n.find(".askro-editable").each(function(){var i,a=t(this),n=a.text().trim(),o=a.data("type")||"text";if("select"===o){var s=a.data("options")||[];i='<select class="askro-admin-form-input">',s.forEach(function(t){var a=t.value===n?"selected":"";i+='<option value="'.concat(t.value,'" ').concat(a,">").concat(t.label,"</option>")}),i+="</select>"}else i='<input type="'.concat(o,'" class="askro-admin-form-input" value="').concat(n,'">');a.data("original-value",n).html(i)}),a.hide(),n.find(".askro-inline-actions").show()},handleInlineSave:function(i){i.preventDefault();var a=t(i.currentTarget),n=a.closest("tr"),o=n.data("id"),s={};n.find(".askro-editable").each(function(){var i=t(this),a=i.data("field"),n=i.find("input, select").val();s[a]=n}),a.prop("disabled",!0).text(this.config.strings.saving),t.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"askro_inline_edit",nonce:this.config.nonce,id:o,data:s},success:function(i){i.success?(n.find(".askro-editable").each(function(){var i=t(this),a=i.data("field");i.text(s[a])}),this.showNotification(i.data.message,"success"),this.exitInlineEdit(n)):this.showNotification(i.data.message,"error")}.bind(this),error:function(){this.showNotification(this.config.strings.save_error,"error")}.bind(this),complete:function(){a.prop("disabled",!1).text(this.config.strings.save)}.bind(this)})},handleInlineCancel:function(i){i.preventDefault();var a=t(i.currentTarget).closest("tr");a.find(".askro-editable").each(function(){var i=t(this),a=i.data("original-value");i.text(a)}),this.exitInlineEdit(a)},exitInlineEdit:function(t){t.find(".askro-inline-edit").show(),t.find(".askro-inline-actions").hide()},handleSelectAll:function(i){var a=t(i.currentTarget),n=a.closest("table"),o=a.is(":checked");n.find('tbody input[type="checkbox"]').prop("checked",o)},handleBulkAction:function(i){i.preventDefault();var a=t(i.currentTarget),n=a.data("action"),o=a.closest(".askro-admin-table-container").find("table"),s=[];o.find('tbody input[type="checkbox"]:checked').each(function(){s.push(t(this).val())}),0!==s.length?confirm(this.config.strings.confirm_bulk_action)&&(a.prop("disabled",!0),t.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"askro_bulk_action",nonce:this.config.nonce,bulk_action:n,ids:s},success:function(t){t.success?(this.showNotification(t.data.message,"success"),location.reload()):this.showNotification(t.data.message,"error")}.bind(this),error:function(){this.showNotification(this.config.strings.bulk_action_error,"error")}.bind(this),complete:function(){a.prop("disabled",!1)}})):this.showNotification(this.config.strings.no_items_selected,"warning")},handleSystemTool:function(i){i.preventDefault();var a=t(i.currentTarget),n=a.data("tool");confirm(this.config.strings.confirm_system_tool)&&(a.prop("disabled",!0).addClass("askro-admin-loading"),t.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"askro_system_tool",nonce:this.config.nonce,tool:n},success:function(t){t.success?(this.showNotification(t.data.message,"success"),t.data.reload&&location.reload()):this.showNotification(t.data.message,"error")}.bind(this),error:function(){this.showNotification(this.config.strings.system_tool_error,"error")}.bind(this),complete:function(){a.prop("disabled",!1).removeClass("askro-admin-loading")}}))},handleSettingsSubmit:function(i){i.preventDefault();var a=t(i.currentTarget),n=a.find('[type="submit"]');n.prop("disabled",!0).text(this.config.strings.saving),t.ajax({url:this.config.ajaxUrl,type:"POST",data:a.serialize()+"&action=askro_save_settings&nonce="+this.config.nonce,success:function(t){t.success?this.showNotification(t.data.message,"success"):this.showNotification(t.data.message,"error")}.bind(this),error:function(){this.showNotification(this.config.strings.save_error,"error")}.bind(this),complete:function(){n.prop("disabled",!1).text(this.config.strings.save_settings)}})},initCharts:function(){"undefined"!=typeof Chart&&(this.initDashboardCharts(),this.initAnalyticsCharts())},initDashboardCharts:function(){var i=t("#askro-questions-chart");if(i.length){var a=i[0].getContext("2d");new Chart(a,{type:"line",data:{labels:i.data("labels")||[],datasets:[{label:this.config.strings.questions,data:i.data("data")||[],borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})}var n=t("#askro-activity-chart");if(n.length){var o=n[0].getContext("2d");new Chart(o,{type:"doughnut",data:{labels:n.data("labels")||[],datasets:[{data:n.data("data")||[],backgroundColor:["#3b82f6","#8b5cf6","#06b6d4","#22c55e","#f59e0b"]}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}},initAnalyticsCharts:function(){t.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"askro_get_analytics",nonce:this.config.nonce},success:function(t){t.success&&this.renderAnalyticsCharts(t.data)}.bind(this)})},renderAnalyticsCharts:function(t){},initColorPickers:function(){t(".askro-color-picker").each(function(){var i=t(this),a=t('<div class="askro-color-picker-wrapper"></div>'),n=t('<div class="askro-color-preview"></div>');i.wrap(a),i.after(n);var o=function(){n.css("background-color",i.val())};o(),i.on("change",o)})},initTooltips:function(){t("[data-tooltip]").each(function(){var i=t(this),a=i.data("tooltip");i.on("mouseenter",function(){AskroAdmin.showTooltip(i,a)}),i.on("mouseleave",function(){AskroAdmin.hideTooltip()})})},showTooltip:function(i,a){var n=t('<div class="askro-admin-tooltip">'+a+"</div>");t("body").append(n);var o=i.offset(),s=i.outerHeight();n.css({top:o.top+s+5,left:o.left+i.outerWidth()/2-n.outerWidth()/2}),n.addClass("askro-fade-in")},hideTooltip:function(){t(".askro-admin-tooltip").remove()},loadDashboardData:function(){t.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"askro_get_dashboard_data",nonce:this.config.nonce},success:function(t){t.success&&this.updateDashboardCards(t.data)}.bind(this)})},updateDashboardCards:function(i){Object.keys(i).forEach(function(a){var n=t('[data-metric="'+a+'"]');n.length&&(n.find(".askro-dashboard-card-value").text(i[a].value),n.find(".askro-dashboard-card-change").text(i[a].change))})},initSortableTables:function(){"undefined"!=typeof Sortable&&t(".askro-sortable-table tbody").each(function(){new Sortable(this,{handle:".askro-drag-handle",animation:150,onEnd:function(t){AskroAdmin.updateTableOrder(t.from)}})})},updateTableOrder:function(i){var a=[];i.find("tr").each(function(){a.push(t(this).data("id"))}),t.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"askro_update_order",nonce:this.config.nonce,order:a},success:function(t){t.success&&this.showNotification(t.data.message,"success")}.bind(this)})},initFormValidation:function(){t(".askro-validate-form").on("submit",function(i){var a=t(this),n=!0;a.find(".askro-field-error").remove(),a.find(".askro-error").removeClass("askro-error"),a.find("[required]").each(function(){var i=t(this);i.val().trim()||(AskroAdmin.showFieldError(i,AskroAdmin.config.strings.field_required),n=!1)}),a.find('[type="email"]').each(function(){var i=t(this),a=i.val().trim();a&&!AskroAdmin.isValidEmail(a)&&(AskroAdmin.showFieldError(i,AskroAdmin.config.strings.invalid_email),n=!1)}),n||i.preventDefault()})},showFieldError:function(i,a){i.addClass("askro-error");var n=t('<div class="askro-field-error">'+a+"</div>");i.after(n)},isValidEmail:function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)},initMediaUploader:function(){t(".askro-media-upload").on("click",function(i){i.preventDefault();var a=t(this),n=a.siblings('input[type="hidden"]'),o=a.siblings(".askro-media-preview"),s=wp.media({title:AskroAdmin.config.strings.select_image,button:{text:AskroAdmin.config.strings.use_image},multiple:!1});s.on("select",function(){var t=s.state().get("selection").first().toJSON();n.val(t.id),o.html('<img src="'+t.url+'" alt="" style="max-width: 150px;">')}),s.open()})},showNotification:function(i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,n=t('\n                <div class="askro-admin-alert askro-admin-alert-'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",'">\n                    ').concat(i,'\n                    <button class="askro-notification-close" style="float: right;">&times;</button>\n                </div>\n            '));t(".askro-admin-container").prepend(n),setTimeout(function(){n.addClass("askro-fade-in")},100),setTimeout(function(){n.remove()},a),n.on("click",".askro-notification-close",function(){n.remove()})}},t(document).ready(function(){AskroAdmin.init()})}(jQuery);
